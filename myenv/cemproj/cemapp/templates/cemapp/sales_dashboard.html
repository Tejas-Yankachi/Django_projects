<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Dashboard</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    {% load static %}
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        .container {
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .dashboard-header h1 {
            color: #007bff; /* Primary color for heading */
        }
        .card {
            border: none;
            border-radius: 0.5rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .card-title {
            font-weight: bold;
            color: #007bff;
        }
        .card-text {
            font-size: 1.75rem;
            font-weight: 300;
        }
        .table thead th {
            background-color: #007bff;
            color: white;
            border-bottom-width: 0;
        }
        .table tbody tr:hover {
            background-color: #e9ecef;
        }
        .btn-outline-primary.active, .btn-outline-primary:active {
            background-color: #007bff;
            color: white;
        }
        .form-control {
            border-radius: 0.25rem;
        }
        .btn {
            border-radius: 0.25rem;
            font-weight: 500;
        }
        .badge-success {
            background-color: #28a745;
            padding: 0.5em 0.75em;
        }
         .position-absolute.btn-primary { /* Home button */
            background-color: #007bff;
            border-color: #007bff;
        }
        .position-absolute.btn-primary:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }

    </style>
</head>
<body>
<div class="container mt-5">
    <div class="dashboard-header">
        <h1 class="mb-0">Sales Dashboard</h1>
        <a href="{% url 'admin_dashboard' %}" class="btn btn-primary">Home</a>
    </div>
    
    <form method="get" class="form-row mb-4 align-items-end">
        <div class="col">
            <input type="date" name="start_date" class="form-control" value="{{ start_date|date:'Y-m-d' }}" placeholder="Start Date">
        </div>
        <div class="col">
            <input type="date" name="end_date" class="form-control" value="{{ end_date|date:'Y-m-d' }}" placeholder="End Date">
        </div>
        <div class="col">
            <input type="text" name="search_query" class="form-control" value="{{ search_query }}" placeholder="Search by Farmer Name, Aadhar, etc.">
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-primary">Search</button>
        </div>
    </form>

    <div class="mb-3">
        <span class="mr-2 font-weight-bold">Sort by:</span>
        <a href="?sort_by=-date" class="btn btn-sm btn-outline-primary {% if request.GET.sort_by == '-date' %}active{% endif %}">Newest First</a>
        <a href="?sort_by=date" class="btn btn-sm btn-outline-primary {% if request.GET.sort_by == 'date' %}active{% endif %}">Oldest First</a>
        <a href="?sort_by=-total_price" class="btn btn-sm btn-outline-primary {% if request.GET.sort_by == '-total_price' %}active{% endif %}">Highest Amount</a>
        <a href="?sort_by=total_price" class="btn btn-sm btn-outline-primary {% if request.GET.sort_by == 'total_price' %}active{% endif %}">Lowest Amount</a>
    </div>

    <div class="row text-center mb-5">
        <div class="col-md-4 mb-3">
            <div class="card">
                <div class="card-body">
                    <h3 class="card-title">Total Sales</h3>
                    <p class="card-text h4">₹{{ total_sales }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card">
                <div class="card-body">
                    <h3 class="card-title">Total Due</h3>
                    <p class="card-text h4">₹{{ total_due }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card">
                <div class="card-body">
                    <h3 class="card-title">Total Orders</h3>
                    <p class="card-text h4">{{ total_orders }}</p>
                </div>
            </div>
        </div>
    </div>
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="thead-dark">
                <tr>
                    <th>Farmer Name</th>
                    <th>Aadhar Number</th>
                    <th>Address</th>
                    <th>Fertilizer</th>
                    <th>Quantity</th>
                    <th>Total Price</th>
                    <th>Amount Paid</th>
                    <th>Balance Due</th>
                    <th>Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for sale in sales %}
                    <tr>
                        <td>{{ sale.farmer_name }}</td>
                        <td>{{ sale.aadhar_number }}</td>
                        <td>{{ sale.address }}</td>
                        <td>{{ sale.fertilizer.name }}</td>
                        <td>{{ sale.quantity_sold }}</td>
                        <td>₹{{ sale.total_price }}</td>
                        <td>₹{{ sale.amount_paid }}</td>
                        <td class="{% if sale.balance_due > 0 %}text-danger font-weight-bold{% else %}text-success{% endif %}">
                            ₹{{ sale.balance_due }}
                        </td>
                        <td>{{ sale.date|date:"Y-m-d" }}</td>
                        <td>
                            {% if sale.balance_due > 0 %}
                                <a href="{% url 'add_payment' sale.id %}" class="btn btn-success btn-sm">Make Payment</a>
                            {% else %}
                                <span class="badge badge-success">Fully Paid</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>